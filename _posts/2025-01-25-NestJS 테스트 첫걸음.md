---
title: "NestJS í…ŒìŠ¤íŠ¸ ì²«ê±¸ìŒ: ë°±ì—”ë“œ ì´ˆë³´ë¥¼ ìœ„í•œ ë°±ì—”ë“œ ì´ˆë³´ì˜ í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ"
date: 2025-01-25 13:40:00 +0900
categories: [ê°œë°œ, ë°±ì—”ë“œ]
tags: [nestjs, í…ŒìŠ¤íŠ¸-ìë™í™”, ë‹¨ìœ„-í…ŒìŠ¤íŠ¸, í†µí•©-í…ŒìŠ¤íŠ¸, e2e-í…ŒìŠ¤íŠ¸, jest, ì¸ì¦]
pin: false
toc: true
--- 

## ğŸš€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±ë¶€í„° JWT ì¸ì¦ ê²€ì¦ê¹Œì§€ í•œë°©ì— ëë‚´ê¸° ğŸš€

ì•ˆë…•í•˜ì„¸ìš”! ì˜¤ëŠ˜ì€ ë°±ì—”ë“œ ê°œë°œì˜ í•µì‹¬! **í…ŒìŠ¤íŠ¸**ì— ëŒ€í•´ ì´ì•¼ê¸°í•´ë³´ë ¤ í•©ë‹ˆë‹¤. íŠ¹íˆ, ë§ì€ ê°œë°œìë¶„ë“¤ì´ ì–´ë ¤ì›Œí•˜ì‹œëŠ” **ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì•„í‚¤í…ì²˜**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ, ì‹¤ì œ **NestJS ì½”ë“œ ì˜ˆì‹œ**ì™€ í•¨ê»˜ **ë°±ì—”ë“œ ì´ˆë³´**ì¸ ì œê°€ ì–´ë–»ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ì„¤ê³„í•˜ê³  ì‘ì„±í•˜ëŠ”ì§€ ì•Œë ¤ë“œë¦´ê²Œìš”. ğŸ‘©â€ğŸ’»ğŸ‘¨â€ğŸ’»

ì˜ ì§œì—¬ì§„ í…ŒìŠ¤íŠ¸ëŠ” íƒ„íƒ„í•œ ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ” ë° í•„ìˆ˜ì ì…ë‹ˆë‹¤. ë§ˆì¹˜ ê±´ë¬¼ì„ ì§“ê¸° ì „ì— ì„¤ê³„ë„ë¥¼ ê¼¼ê¼¼íˆ í™•ì¸í•˜ëŠ” ê²ƒì²˜ëŸ¼, í…ŒìŠ¤íŠ¸ëŠ” ìš°ë¦¬ê°€ ì‘ì„±í•œ ì½”ë“œì˜ ì•ˆì •ì„±ê³¼ ì‹ ë¢°ì„±ì„ ë³´ì¥í•´ ì¤ë‹ˆë‹¤. ğŸ’ª

### ì™œ ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì•„í‚¤í…ì²˜ê°€ ì¤‘ìš”í• ê¹Œìš”? ğŸ¤”

- **ì½”ë“œ í’ˆì§ˆ í–¥ìƒ:** í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ëŠ” ê³¼ì •ì—ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ì½”ë“œ ì„¤ê³„ë¥¼ ë‹¤ì‹œ ìƒê°í•˜ê²Œ ë˜ê³ , ë” ê²¬ê³ í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´ ì½”ë“œë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ë²„ê·¸ ì¡°ê¸° ë°œê²¬:** ê°œë°œ ì´ˆê¸° ë‹¨ê³„ì—ì„œ ë²„ê·¸ë¥¼ ë°œê²¬í•˜ê³  ìˆ˜ì •í•˜ì—¬, ì„œë¹„ìŠ¤ ë¦´ë¦¬ì¦ˆ í›„ ë°œìƒí•  ìˆ˜ ìˆëŠ” ì‹¬ê°í•œ ë¬¸ì œë“¤ì„ ì˜ˆë°©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ›
- **ë¦¬íŒ©í† ë§ ì•ˆì •ì„± í™•ë³´:** ì½”ë“œ êµ¬ì¡°ë¥¼ ë³€ê²½í•˜ê±°ë‚˜ ê¸°ëŠ¥ì„ ê°œì„ í•  ë•Œ, ê¸°ì¡´ ê¸°ëŠ¥ì„ ë§ê°€ëœ¨ë¦¬ì§€ ì•Šì•˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ ë¹ ë¥´ê²Œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ğŸ”„
- **ê°œë°œ ì†ë„ í–¥ìƒ:**  ìë™í™”ëœ í…ŒìŠ¤íŠ¸ëŠ” ê°œë°œ ê³¼ì •ì˜ ë°˜ë³µ ì‘ì—…ì„ ì¤„ì—¬ì£¼ê³ , ë¹ ë¥´ê²Œ í”¼ë“œë°±ì„ ì–»ì„ ìˆ˜ ìˆê²Œ í•˜ì—¬ ì „ì²´ ê°œë°œ ì†ë„ë¥¼ í–¥ìƒì‹œí‚µë‹ˆë‹¤. ğŸš€
- **íŒ€ í˜‘ì—… íš¨ìœ¨ ì¦ëŒ€:**  í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” ë¬¸ì„œ ì—­í• ë„ í•˜ê¸° ë•Œë¬¸ì—, íŒ€ì›ë“¤ì´ ì½”ë“œë¥¼ ì´í•´í•˜ê³  í˜‘ì—…í•˜ëŠ” ë° í° ë„ì›€ì´ ë©ë‹ˆë‹¤. ğŸ¤

### ì£¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ì–´ë–»ê²Œ ì ‘ê·¼í•´ì•¼ í• ê¹Œìš”? ğŸ¢

**í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ** ë¼ëŠ” ê°œë…, ë“¤ì–´ë³´ì…¨ë‚˜ìš”? ê¸°ì—…ë“¤ì€ íš¨ê³¼ì ì¸ í…ŒìŠ¤íŠ¸ ì „ëµì„ ìœ„í•´ í”¼ë¼ë¯¸ë“œ ëª¨ë¸ì„ ë§ì´ ì°¸ê³ í•©ë‹ˆë‹¤.

### í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ
![í…ŒìŠ¤íŠ¸ í”¼ë¼ë¯¸ë“œ](/assets/img/posts/test-pyramid.webp)
- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: 70% (ë¹ ë¥´ê³  ì§‘ì¤‘ì )
- **í†µí•© í…ŒìŠ¤íŠ¸**: 20% (ëª¨ë“ˆ ê°„ ìƒí˜¸ì‘ìš©)
- **E2E í…ŒìŠ¤íŠ¸**: 10% (ì „ì²´ ì‹œìŠ¤í…œ ê²€ì¦)

**ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Unit Test): í”¼ë¼ë¯¸ë“œì˜ ê°€ì¥ ë°‘ë‹¨ì´ì í•µì‹¬!**
- ê°€ì¥ ì‘ê³  ë…ë¦½ì ì¸ ì½”ë“œ ë‹¨ìœ„ (í•¨ìˆ˜, ë©”ì„œë“œ, í´ë˜ìŠ¤ ë“±) ë¥¼ ê²©ë¦¬í•˜ì—¬ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
- ë¹ ë¥´ê³  ì‰½ê²Œ ì‘ì„± ë° ì‹¤í–‰ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.
- ëª¨ë“  ê¸°ëŠ¥ì˜ í•µì‹¬ ë¡œì§ì„ ê¼¼ê¼¼í•˜ê²Œ ê²€ì¦í•˜ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤.
- **Mocking (ëª¨í‚¹)** ê¸°ë²•ì„ ì‚¬ìš©í•˜ì—¬ ì™¸ë¶€ ì˜ì¡´ì„± (ë‹¤ë¥¸ ëª¨ë“ˆ, DB, API ë“±)ì„ ê°€ì§œ ê°ì²´ë¡œ ëŒ€ì²´í•˜ê³ , ì˜¤ì§ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì½”ë“œì—ë§Œ ì§‘ì¤‘í•©ë‹ˆë‹¤.
- ì˜ˆì‹œ: ì„œë¹„ìŠ¤ ë ˆì´ì–´ì˜ íŠ¹ì • ë©”ì„œë“œ, ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜, ëª¨ë¸ì˜ ë¡œì§ ë“±

- **í†µí•© í…ŒìŠ¤íŠ¸ (Integration Test): ì¤‘ê°„ ë ˆë²¨!**
  - ì—¬ëŸ¬ ê°œì˜ ë‹¨ìœ„ ëª¨ë“ˆì´ **í•¨ê»˜** ì‘ë™í•˜ëŠ” ê²ƒì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
  - ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ëŠ” ëŠë¦¬ì§€ë§Œ, ì‹œìŠ¤í…œ ì „ì²´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” ë¹ ë¦…ë‹ˆë‹¤.
  - ì‹¤ì œ í™˜ê²½ê³¼ ìœ ì‚¬í•œ í™˜ê²½ì—ì„œ í…ŒìŠ¤íŠ¸í•˜ì—¬, ëª¨ë“ˆ ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ ê²€ì¦í•©ë‹ˆë‹¤.
  - ì‹¤ì œ DB, API, ì™¸ë¶€ ì„œë¹„ìŠ¤ ë“±ì„ ì—°ë™í•˜ì—¬ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  - ì˜ˆì‹œ: ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ì„œë¹„ìŠ¤ ë ˆì´ì–´ì˜ í†µí•©, ì„œë¹„ìŠ¤ì™€ ë¦¬í¬ì§€í† ë¦¬ ë ˆì´ì–´ì˜ í†µí•©, API ì—”ë“œí¬ì¸íŠ¸ í†µí•© ë“±

- **E2E í…ŒìŠ¤íŠ¸ (End-to-End Test): í”¼ë¼ë¯¸ë“œì˜ ìµœìƒë‹¨!**
  - ì‹¤ì œ ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ, **ì‹œìŠ¤í…œ ì „ì²´**ë¥¼ ì²˜ìŒë¶€í„° ëê¹Œì§€ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
  - ê°€ì¥ ëŠë¦¬ê³  ë¹„ìš©ì´ ë§ì´ ë“œëŠ” í…ŒìŠ¤íŠ¸ì´ì§€ë§Œ, ì‚¬ìš©ì ê´€ì ì—ì„œ ì‹œìŠ¤í…œì˜ ì „ì²´ì ì¸ ê¸°ëŠ¥ì„ ê²€ì¦í•©ë‹ˆë‹¤.
  - UI í…ŒìŠ¤íŠ¸, API í…ŒìŠ¤íŠ¸ ë“±ì„ í¬í•¨í•˜ë©°, ì‹¤ì œ ì‚¬ìš© í™˜ê²½ê³¼ ìµœëŒ€í•œ ìœ ì‚¬í•˜ê²Œ êµ¬ì„±í•©ë‹ˆë‹¤.
  - ì˜ˆì‹œ: ë¡œê·¸ì¸ë¶€í„° íŠ¹ì • ê¸°ëŠ¥ ì‚¬ìš© ì™„ë£Œê¹Œì§€ì˜ ì „ì²´ íë¦„, ì‚¬ìš©ì ì£¼ë¬¸ í”„ë¡œì„¸ìŠ¤ ë“±

| êµ¬ë¶„          | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸          | í†µí•© í…ŒìŠ¤íŠ¸             | E2E í…ŒìŠ¤íŠ¸               |
|---------------|---------------------|------------------------|-------------------------|
| **ëª©ì **      | í•¨ìˆ˜/í´ë˜ìŠ¤ ê²€ì¦     | ëª¨ë“ˆ ê°„ ì—°ê²° ê²€ì¦       | ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦     |
| **ì†ë„**      | ë¹ ë¦„                | ì¤‘ê°„                   | ëŠë¦¼                    |
| **ì˜ì¡´ì„±**    | Mocking ì‚¬ìš©        | ì‹¤ì œ DB/API ë¶€ë¶„ ì‚¬ìš©  | ì „ì²´ ì‹œìŠ¤í…œ ì‚¬ìš©         |
| **ì˜ˆì‹œ**      | `AuthService.login` | `AuthController â†” AuthService` | ë¡œê·¸ì¸ â†’ í”„ë¡œí•„ ì¡°íšŒ     |



**í”¼ë¼ë¯¸ë“œ í˜•íƒœì¸ ì´ìœ ?**

- **ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**ëŠ” ë¹ ë¥´ê³  ê²©ë¦¬ëœ í™˜ê²½ì—ì„œ ì‹¤í–‰ë˜ë¯€ë¡œ, ê°œë°œ ì´ˆê¸°ì— ë§ì´ ì‘ì„±í•˜ì—¬ ë¹ ë¥´ê²Œ ë²„ê·¸ë¥¼ ì¡ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤.
- **í†µí•© í…ŒìŠ¤íŠ¸**ì™€ **E2E í…ŒìŠ¤íŠ¸**ëŠ” ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë³´ë‹¤ ëŠë¦¬ê³  í™˜ê²½ ì„¤ì •ì´ ë³µì¡í•˜ë¯€ë¡œ, í•µì‹¬ ê¸°ëŠ¥ ìœ„ì£¼ë¡œ ì ì ˆí•œ ìˆ˜ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤.


### NestJS ì½”ë“œ ì˜ˆì‹œë¡œ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì•„í‚¤í…ì²˜ ì‚´í´ë³´ê¸° ğŸ”

ì, ì´ì œ ì‹¤ì œ ì½”ë“œë¥¼ ë³´ë©´ì„œ ì¢€ ë” ìì„¸íˆ ì•Œì•„ë³¼ê¹Œìš”? ì—¬ëŸ¬ë¶„ì´ ì˜¬ë ¤ì£¼ì‹  **AuthController**ì™€ **AuthService** í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì˜ˆì‹œë¡œ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

#### 1. AuthController ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (AuthController.spec.ts)

```typescript
import { Test, TestingModule } from '@nestjs/testing';
import { AuthController } from './auth.controller';
import { AuthService } from './auth.service';
import { RegisterDto } from './dto/register.dto';
import { LoginDto } from './dto/login.dto';
import { Gender } from '../users/enums/user.enum';

describe('AuthController', () => {
  let controller: AuthController;
  let authService: AuthService;

  // âœ… AuthServiceë¥¼ Mocking í•©ë‹ˆë‹¤. (ì§„ì§œ AuthService ëŒ€ì‹  ê°€ì§œ ê°ì²´ ì‚¬ìš©)
  const mockAuthService = {
    register: jest.fn(), // jest.fn(): Jest Mock í•¨ìˆ˜ ìƒì„±
    login: jest.fn(),
    deleteAccount: jest.fn(),
  };

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      controllers: [AuthController],
      providers: [
        {
          provide: AuthService, // AuthControllerê°€ ì˜ì¡´í•˜ëŠ” AuthServiceë¥¼
          useValue: mockAuthService, // mockAuthServiceë¡œ ëŒ€ì²´
        },
      ],
    }).compile();

    controller = module.get<AuthController>(AuthController);
    authService = module.get<AuthService>(AuthService);

    jest.clearAllMocks(); // ê° í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‹œì‘ ì „ì— Mock í•¨ìˆ˜ í˜¸ì¶œ ê¸°ë¡ ì´ˆê¸°í™”
  });

  it('should be defined', () => {
    expect(controller).toBeDefined();
  });

  describe('register', () => {
    it('should register a new user successfully', async () => {
      // Arrange (ì¤€ë¹„): í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ë°ì´í„°ì™€ Mock ì„¤ì •
      const registerDto: RegisterDto = {
        email: 'test@example.com',
        password: 'Test123!@#',
        name: 'í™ê¸¸ë™',
        gender: Gender.MALE,
        country: 'KR',
      };
      // âœ… mockAuthService.register() ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ 'mock-token' ë°˜í™˜í•˜ë„ë¡ ì„¤ì •
      mockAuthService.register.mockResolvedValue({ accessToken: 'mock-token' });

      // Act (ì‹¤í–‰): í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ì½”ë“œ ì‹¤í–‰ (AuthControllerì˜ register ë©”ì„œë“œ)
      const result = await controller.register(registerDto);

      // Assert (ê²€ì¦): ì‹¤í–‰ ê²°ê³¼ ë° Mock í•¨ìˆ˜ í˜¸ì¶œ ì—¬ë¶€ ê²€ì¦
      expect(result).toEqual({ accessToken: 'mock-token' }); // ë°˜í™˜ê°’ì´ ì˜ˆìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
      // âœ… mockAuthService.register()ê°€ registerDtoì™€ í•¨ê»˜ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸
      expect(mockAuthService.register).toHaveBeenCalledWith(registerDto);
    });
  });

  // ... (login, getProfile, deleteAccount í…ŒìŠ¤íŠ¸ ìƒëµ) ...
});
```
**ì£¼ìš” í¬ì¸íŠ¸:**

- **ì»¨íŠ¸ë¡¤ëŸ¬ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸**: `AuthController` ìì²´ì˜ ë¡œì§ë§Œ í…ŒìŠ¤íŠ¸í•˜ê³ , `AuthService`ì˜ ë™ì‘ì€ **Mocking**ìœ¼ë¡œ ëŒ€ì²´í•©ë‹ˆë‹¤.
- **`mockAuthService`**: `AuthService`ë¥¼ í‰ë‚´ë‚´ëŠ” ê°€ì§œ ê°ì²´ë¥¼ ìƒì„±í•˜ì—¬, í…ŒìŠ¤íŠ¸ë¥¼ ê²©ë¦¬í•˜ê³  ì˜ˆì¸¡ ê°€ëŠ¥í•œ í™˜ê²½ì„ ë§Œë“­ë‹ˆë‹¤.
- **`jest.fn()`**: Jestì—ì„œ ì œê³µí•˜ëŠ” Mock í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤. Mock í•¨ìˆ˜ì˜ ë™ì‘ì„ `mockResolvedValue`, `mockRejectedValue`, `mockImplementation` ë“±ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **`toHaveBeenCalledWith()`**: Mock í•¨ìˆ˜ê°€ íŠ¹ì • ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦í•˜ëŠ” Jest Matcherì…ë‹ˆë‹¤.
- **AAA íŒ¨í„´ (Arrange-Act-Assert)**: í…ŒìŠ¤íŠ¸ êµ¬ì¡°ë¥¼ ëª…í™•í•˜ê²Œ ë‚˜ëˆ„ì–´ ê°€ë…ì„±ì„ ë†’ì…ë‹ˆë‹¤.


```typescript
import { Test, TestingModule } from '@nestjs/testing';
import { AuthService } from './auth.service';
import { User } from '../users/entities/user.entity';
import { JwtService } from '@nestjs/jwt';
import { getRepositoryToken } from '@nestjs/typeorm';
import { RegisterDto } from './dto/register.dto';
import { LoginDto } from './dto/login.dto';
import { Gender } from '../users/enums/user.enum';
import { ConflictException, UnauthorizedException } from '@nestjs/common';
import * as bcrypt from 'bcryptjs';

jest.mock('bcryptjs'); // âœ… bcryptjs ëª¨ë“ˆ ì „ì²´ë¥¼ Mocking

describe('AuthService', () => {
  let service: AuthService;
  let jwtService: JwtService;

  // âœ… UserRepositoryë¥¼ Mocking í•©ë‹ˆë‹¤.
  const mockUserRepository = {
    findOne: jest.fn(),
    create: jest.fn(),
    save: jest.fn(),
    delete: jest.fn(),
  };

  // âœ… JwtServiceë¥¼ Mocking í•©ë‹ˆë‹¤.
  const mockJwtService = {
    sign: jest.fn(),
  };

  beforeEach(async () => {
    const module: TestingModule = await Test.createTestingModule({
      providers: [
        AuthService,
        {
          provide: getRepositoryToken(User), // UserRepositoryë¥¼
          useValue: mockUserRepository, // mockUserRepositoryë¡œ ëŒ€ì²´
        },
        {
          provide: JwtService, // JwtServiceë¥¼
          useValue: mockJwtService, // mockJwtServiceë¡œ ëŒ€ì²´
        },
      ],
    }).compile();

    service = module.get<AuthService>(AuthService);
    jwtService = module.get<JwtService>(JwtService);

    jest.clearAllMocks();
  });

  it('should be defined', () => {
    expect(service).toBeDefined();
  });

  describe('register', () => {
    // ... (register ì„±ê³µ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤) ...

    it('should throw ConflictException if email already exists', async () => {
      // Arrange
      const registerDto: RegisterDto = { /* ... */ };
      // âœ… mockUserRepository.findOne()ì´ ì‚¬ìš©ì ì •ë³´ë¥¼ ë°˜í™˜í•˜ë„ë¡ ì„¤ì • (ì´ë©”ì¼ ì¤‘ë³µ ìƒí™©)
      mockUserRepository.findOne.mockResolvedValue({
        id: '123',
        email: registerDto.email,
      });

      // Act & Assert (ì‹¤í–‰ ë° ì˜ˆì™¸ ê²€ì¦)
      await expect(service.register(registerDto)).rejects.toThrow(
        ConflictException, // ì˜ˆìƒë˜ëŠ” ì˜ˆì™¸: ConflictException
      );
    });
  });

  describe('login', () => {
    it('should successfully authenticate user and return access token', async () => {
      // Arrange (ì¤€ë¹„): í…ŒìŠ¤íŠ¸ í™˜ê²½ ë° ì˜ˆìƒ ë°ì´í„° ì„¤ì •
      const loginDto: LoginDto = { // âœ… ë¡œê·¸ì¸ì— í•„ìš”í•œ DTO (Data Transfer Object) ìƒì„±
        email: 'test@example.com',
        password: 'Test123!@#',
      };
      const mockUser = { // âœ… ê°€ì§œ ì‚¬ìš©ì ê°ì²´ ìƒì„± (UserRepository Mocking)
        id: '123',
        email: loginDto.email,
        password: 'hashed-password', //  DBì— ì €ì¥ëœ í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ë¼ê³  ê°€ì •
      };
      const mockToken = 'mock.jwt.token'; // âœ… Mock JwtServiceì—ì„œ ë°˜í™˜ë  ê°€ì§œ JWT í† í°

      // âœ… UserRepositoryì˜ findOne ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ mockUserë¥¼ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì •
      mockUserRepository.findOne.mockResolvedValue(mockUser);
      // âœ… bcrypt.compare ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ true (ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜)ë¥¼ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì •
      (bcrypt.compare as jest.Mock).mockResolvedValue(true);
      // âœ… JwtServiceì˜ sign ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ mockTokenì„ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì •
      mockJwtService.sign.mockReturnValue(mockToken);

      // Act (ì‹¤í–‰): í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë©”ì„œë“œ (AuthServiceì˜ login ë©”ì„œë“œ) ì‹¤í–‰
      const result = await service.login(loginDto); // âœ… loginDtoë¥¼ ì¸ìë¡œ AuthServiceì˜ login ë©”ì„œë“œ í˜¸ì¶œ

      // Assert (ê²€ì¦): ì‹¤í–‰ ê²°ê³¼ ë° Mock ê°ì²´ ìƒí˜¸ì‘ìš© ê²€ì¦
      expect(result).toEqual({ accessToken: mockToken }); // âœ… ë°˜í™˜ëœ ê²°ê³¼ (accessToken)ì´ ì˜ˆìƒ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦
      // âœ… UserRepositoryì˜ findOne ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦ (ì´ë©”ì¼ê³¼ isDeleted: false ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©ì ê²€ìƒ‰)
      expect(mockUserRepository.findOne).toHaveBeenCalledWith({
        where: { email: loginDto.email, isDeleted: false },
      });
      // âœ… bcrypt.compare ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦ (ì…ë ¥ ë¹„ë°€ë²ˆí˜¸ì™€ DB ë¹„ë°€ë²ˆí˜¸ ë¹„êµ)
      expect(bcrypt.compare).toHaveBeenCalledWith(
        loginDto.password,
        mockUser.password,
      );
      // âœ… JwtServiceì˜ sign ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦ (JWT payload - sub, email ìƒì„±)
      expect(mockJwtService.sign).toHaveBeenCalledWith({
        sub: mockUser.id,
        email: mockUser.email,
      });
    });

    it('should throw UnauthorizedException when user not found', async () => {
      // Arrange (ì¤€ë¹„): ì‚¬ìš©ì ì •ë³´ê°€ ì—†ëŠ” ìƒí™© ì„¤ì •
      const loginDto: LoginDto = { // ë¡œê·¸ì¸ DTO (ê°€ì§œ ì´ë©”ì¼)
        email: 'nonexistent@example.com',
        password: 'Test123!@#',
      };
      // âœ… UserRepository.findOne()ì´ nullì„ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì • (ì‚¬ìš©ì ì°¾ì„ ìˆ˜ ì—†ìŒ)
      mockUserRepository.findOne.mockResolvedValue(null);

      // Act & Assert (ì‹¤í–‰ ë° ì˜ˆì™¸ ê²€ì¦): login ë©”ì„œë“œ ì‹¤í–‰ ì‹œ UnauthorizedException ë°œìƒ ê²€ì¦
      await expect(service.login(loginDto)).rejects.toThrow(
        UnauthorizedException, // âœ… ì˜ˆìƒëŒ€ë¡œ UnauthorizedException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ ê²€ì¦
      );
    });

    it('should handle special characters in email during login', async () => {
      const loginDto: LoginDto = {
        email: 'invalid-email-format',
        password: 'Test123!@#'
      };
      await expect(service.login(loginDto)).rejects.toThrow(BadRequestException); // âœ… 400 ì—ëŸ¬ ë°œìƒ ê¸°ëŒ€
      
     // ì¶”ê°€ ê²€ì¦: ì‹¤ì œ ë¡œì§ì´ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ëŠ”ì§€ í™•ì¸
      expect(mockUserRepository.findOne).not.toHaveBeenCalled(); // âœ… DB ì¡°íšŒ X
      expect(bcrypt.compare).not.toHaveBeenCalled(); // âœ… ë¹„ë°€ë²ˆí˜¸ ë¹„êµ X
      expect(mockJwtService.sign).not.toHaveBeenCalled(); // âœ… í† í° ìƒì„± X
    });

    it('should throw UnauthorizedException when password is incorrect', async () => {
      // Arrange (ì¤€ë¹„): ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦° ìƒí™© ì„¤ì •
      const loginDto: LoginDto = { // ë¡œê·¸ì¸ DTO
        email: 'test@example.com',
        password: 'WrongPassword123!@#', // í‹€ë¦° ë¹„ë°€ë²ˆí˜¸
      };
      const mockUser = { // ê°€ì§œ ì‚¬ìš©ì ê°ì²´ (ì •ìƒ ì‚¬ìš©ì)
        id: '123',
        email: loginDto.email,
        password: 'hashed-password', // DBì— ì €ì¥ëœ í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸
      };

      // âœ… UserRepository.findOne()ì€ mockUser ë°˜í™˜ (ì‚¬ìš©ìëŠ” ì¡´ì¬)
      mockUserRepository.findOne.mockResolvedValue(mockUser);
      // âœ… bcrypt.compare()ëŠ” false ë°˜í™˜ (ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜)
      (bcrypt.compare as jest.Mock).mockResolvedValue(false);

      // Act & Assert (ì‹¤í–‰ ë° ì˜ˆì™¸ ê²€ì¦): login ë©”ì„œë“œ ì‹¤í–‰ ì‹œ UnauthorizedException ë°œìƒ ê²€ì¦
      await expect(service.login(loginDto)).rejects.toThrow(
        UnauthorizedException, // âœ… ì˜ˆìƒëŒ€ë¡œ UnauthorizedException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ ê²€ì¦
      );
    });
  });
});
```

### âœ¨ ì½”ë“œ ì˜ˆì‹œ ìƒì„¸ í•´ì„¤: AuthService `login` í…ŒìŠ¤íŠ¸ âœ¨

ì´ì œ ì¡°ê¸ˆ ë” ê¹Šì´ ë“¤ì–´ê°€ì„œ, `AuthService`ì˜ `login` í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ **Arrange-Act-Assert (AAA) íŒ¨í„´**ì— ë§ì¶° ìì„¸íˆ í•´ì„¤í•´ ë“œë¦´ê²Œìš”.  í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ë” ì‰½ê³  ëª…í™•í•˜ê²Œ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë  ê±°ì˜ˆìš”.

**ğŸ¤” ì™œ AAA íŒ¨í„´ì„ ì‚¬ìš©í•´ì•¼ í• ê¹Œìš”?**

AAA íŒ¨í„´ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œì˜ **êµ¬ì¡°ë¥¼ ëª…í™•í•˜ê²Œ** ë§Œë“¤ê³ , **ê°€ë…ì„±ì„ ë†’ì—¬ì£¼ë©°**, **ìœ ì§€ë³´ìˆ˜ë¥¼ ìš©ì´í•˜ê²Œ** í•´ì£¼ëŠ” ì•„ì£¼ ìœ ìš©í•œ íŒ¨í„´ì…ë‹ˆë‹¤. ë§ˆì¹˜ ìš”ë¦¬ ë ˆì‹œí”¼ì²˜ëŸ¼, ê° ë‹¨ê³„ë¥¼ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•˜ì—¬ í…ŒìŠ¤íŠ¸ì˜ ëª©ì ê³¼ ê³¼ì •ì„ ì‰½ê²Œ íŒŒì•…í•  ìˆ˜ ìˆê²Œ ë„ì™€ì¤ë‹ˆë‹¤.

- **Arrange (ì¤€ë¹„):** í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ëª¨ë“  ì‚¬ì „ ì¤€ë¹„ ë‹¨ê³„ì…ë‹ˆë‹¤. í…ŒìŠ¤íŠ¸ì— í•„ìš”í•œ ì…ë ¥ ë°ì´í„°(request, parameter ë“±), Mock ê°ì²´ ì„¤ì •, í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì„± ë“±ì„ í¬í•¨í•©ë‹ˆë‹¤. "ì´ëŸ¬ì´ëŸ¬í•œ ìƒí™©ì„ ë§Œë“¤ê³ "ì— í•´ë‹¹í•©ë‹ˆë‹¤.
- **Act (ì‹¤í–‰):** ì‹¤ì œë¡œ í…ŒìŠ¤íŠ¸í•˜ê³ ì í•˜ëŠ” ì½”ë“œ ì¡°ê°ì„ ì‹¤í–‰í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì£¼ë¡œ í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤. "ì´ê²ƒì„ ì‹¤í–‰í–ˆì„ ë•Œ" ì— í•´ë‹¹í•©ë‹ˆë‹¤.
- **Assert (ê²€ì¦):** Act ë‹¨ê³„ì—ì„œ ì‹¤í–‰ëœ ì½”ë“œì˜ ê²°ê³¼ë¥¼ ê²€ì¦í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ì˜ˆìƒ ê²°ê³¼ì™€ ì‹¤ì œ ê²°ê³¼ë¥¼ ë¹„êµí•˜ê³ , Mock ê°ì²´ê°€ ì˜ˆìƒëŒ€ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤. "ì´ëŸ¬ì´ëŸ¬í•œ ê²°ê³¼ê°€ ë‚˜ì™€ì•¼ í•œë‹¤" ì— í•´ë‹¹í•©ë‹ˆë‹¤.

ì, ê·¸ëŸ¼ `AuthService`ì˜ `login` í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ AAA íŒ¨í„´ì— ë§ì¶° ë¶„ì„í•´ ë³¼ê¹Œìš”?


```typescript

  describe('login', () => {
    it('should successfully authenticate user and return access token', async () => {
      // Arrange (ì¤€ë¹„): í…ŒìŠ¤íŠ¸ í™˜ê²½ ë° ì˜ˆìƒ ë°ì´í„° ì„¤ì •
      const loginDto: LoginDto = { // âœ… ë¡œê·¸ì¸ì— í•„ìš”í•œ DTO (Data Transfer Object) ìƒì„±
        email: 'test@example.com',
        password: 'Test123!@#',
      };
      const mockUser = { // âœ… Mock UserRepositoryì—ì„œ ë°˜í™˜ë  ê°€ì§œ ì‚¬ìš©ì ê°ì²´
        id: '123',
        email: loginDto.email,
        password: 'hashed-password', //  DBì— ì €ì¥ëœ í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸ë¼ê³  ê°€ì •
      };
      const mockToken = 'mock.jwt.token'; // âœ… Mock JwtServiceì—ì„œ ë°˜í™˜ë  ê°€ì§œ JWT í† í°

      // âœ… UserRepositoryì˜ findOne ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ mockUserë¥¼ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì •
      mockUserRepository.findOne.mockResolvedValue(mockUser);
      // âœ… bcrypt.compare ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ true (ë¹„ë°€ë²ˆí˜¸ ì¼ì¹˜)ë¥¼ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì •
      (bcrypt.compare as jest.Mock).mockResolvedValue(true);
      // âœ… JwtServiceì˜ sign ë©”ì„œë“œê°€ í˜¸ì¶œë  ë•Œ mockTokenì„ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì •
      mockJwtService.sign.mockReturnValue(mockToken);

      // Act (ì‹¤í–‰): í…ŒìŠ¤íŠ¸ ëŒ€ìƒ ë©”ì„œë“œ (AuthServiceì˜ login ë©”ì„œë“œ) ì‹¤í–‰
      const result = await service.login(loginDto); // âœ… loginDtoë¥¼ ì¸ìë¡œ AuthServiceì˜ login ë©”ì„œë“œ í˜¸ì¶œ

      // Assert (ê²€ì¦): ì‹¤í–‰ ê²°ê³¼ ë° Mock ê°ì²´ ìƒí˜¸ì‘ìš© ê²€ì¦
      expect(result).toEqual({ accessToken: mockToken }); // âœ… ë°˜í™˜ëœ ê²°ê³¼ (accessToken)ì´ ì˜ˆìƒ ê°’ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ê²€ì¦
      // âœ… UserRepositoryì˜ findOne ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦ (ì´ë©”ì¼ê³¼ isDeleted: false ì¡°ê±´ìœ¼ë¡œ ì‚¬ìš©ì ê²€ìƒ‰)
      expect(mockUserRepository.findOne).toHaveBeenCalledWith({
        where: { email: loginDto.email, isDeleted: false },
      });
      // âœ… bcrypt.compare ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦ (ì…ë ¥ ë¹„ë°€ë²ˆí˜¸ì™€ DB ë¹„ë°€ë²ˆí˜¸ ë¹„êµ)
      expect(bcrypt.compare).toHaveBeenCalledWith(
        loginDto.password,
        mockUser.password,
      );
      // âœ… JwtServiceì˜ sign ë©”ì„œë“œê°€ ì˜¬ë°”ë¥¸ ì¸ìˆ˜ë¡œ í˜¸ì¶œë˜ì—ˆëŠ”ì§€ ê²€ì¦ (JWT payload - sub, email ìƒì„±)
      expect(mockJwtService.sign).toHaveBeenCalledWith({
        sub: mockUser.id,
        email: mockUser.email,
      });
    });

    it('should throw UnauthorizedException when user not found', async () => {
      // Arrange (ì¤€ë¹„): ì‚¬ìš©ì ì •ë³´ê°€ ì—†ëŠ” ìƒí™© ì„¤ì •
      const loginDto: LoginDto = { // ë¡œê·¸ì¸ DTO (ê°€ì§œ ì´ë©”ì¼)
        email: 'nonexistent@example.com',
        password: 'Test123!@#',
      };
      // âœ… UserRepository.findOne()ì´ nullì„ ë°˜í™˜í•˜ë„ë¡ Mock ì„¤ì • (ì‚¬ìš©ì ì°¾ì„ ìˆ˜ ì—†ìŒ)
      mockUserRepository.findOne.mockResolvedValue(null);

      // Act & Assert (ì‹¤í–‰ ë° ì˜ˆì™¸ ê²€ì¦): login ë©”ì„œë“œ ì‹¤í–‰ ì‹œ UnauthorizedException ë°œìƒ ê²€ì¦
      await expect(service.login(loginDto)).rejects.toThrow(
        UnauthorizedException, // âœ… ì˜ˆìƒëŒ€ë¡œ UnauthorizedException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ ê²€ì¦
      );
    });

    it('should throw UnauthorizedException when password is incorrect', async () => {
      // Arrange (ì¤€ë¹„): ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë¦° ìƒí™© ì„¤ì •
      const loginDto: LoginDto = { // ë¡œê·¸ì¸ DTO
        email: 'test@example.com',
        password: 'WrongPassword123!@#', // í‹€ë¦° ë¹„ë°€ë²ˆí˜¸
      };
      const mockUser = { // ê°€ì§œ ì‚¬ìš©ì ê°ì²´ (ì •ìƒ ì‚¬ìš©ì)
        id: '123',
        email: loginDto.email,
        password: 'hashed-password', // DBì— ì €ì¥ëœ í•´ì‹±ëœ ë¹„ë°€ë²ˆí˜¸
      };

      // âœ… UserRepository.findOne()ì€ mockUser ë°˜í™˜ (ì‚¬ìš©ìëŠ” ì¡´ì¬)
      mockUserRepository.findOne.mockResolvedValue(mockUser);
      // âœ… bcrypt.compare()ëŠ” false ë°˜í™˜ (ë¹„ë°€ë²ˆí˜¸ ë¶ˆì¼ì¹˜)
      (bcrypt.compare as jest.Mock).mockResolvedValue(false);

      // Act & Assert (ì‹¤í–‰ ë° ì˜ˆì™¸ ê²€ì¦): login ë©”ì„œë“œ ì‹¤í–‰ ì‹œ UnauthorizedException ë°œìƒ ê²€ì¦
      await expect(service.login(loginDto)).rejects.toThrow(
        UnauthorizedException, // âœ… ì˜ˆìƒëŒ€ë¡œ UnauthorizedException ì˜ˆì™¸ê°€ ë°œìƒí•˜ëŠ”ì§€ ê²€ì¦
      );
    });
  });
```


### íš¨ê³¼ì ì¸ ë°±ì—”ë“œ í…ŒìŠ¤íŠ¸ ì‘ì„±ì„ ìœ„í•œ íŒ ê¿€íŒ ğŸ¯

- **í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ì½”ë“œë‹¤!:** í…ŒìŠ¤íŠ¸ ì½”ë“œ ë˜í•œ ê¹¨ë—í•˜ê³  ìœ ì§€ë³´ìˆ˜ ê°€ëŠ¥í•˜ê²Œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
  - ëª…í™•í•œ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì´ë¦„ (ì˜ˆ: `should register a new user successfully`)
  - AAA íŒ¨í„´, ì¤‘ë³µ ì œê±°, ì ì ˆí•œ ì£¼ì„ í™œìš©
- **ê²½ê³„ê°’ í…ŒìŠ¤íŠ¸ (Boundary Value Test):** ì…ë ¥ê°’ì˜ ê²½ê³„ ì¡°ê±´ (ìµœì†Œê°’, ìµœëŒ€ê°’, null, empty ë“±) ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë¥¼ ê¼¼ê¼¼í•˜ê²Œ ì‘ì„±í•˜ì—¬ ì˜ˆìƒì¹˜ ëª»í•œ ì—ëŸ¬ë¥¼ ë°©ì§€í•©ë‹ˆë‹¤.
- **ì˜ˆì™¸ ì¼€ì´ìŠ¤ í…ŒìŠ¤íŠ¸:** ì •ìƒì ì¸ íë¦„ ë¿ë§Œ ì•„ë‹ˆë¼, ì˜ˆì™¸ ìƒí™© (ì˜ëª»ëœ ì…ë ¥, ì™¸ë¶€ ì„œë¹„ìŠ¤ ì˜¤ë¥˜ ë“±) ì— ëŒ€í•œ í…ŒìŠ¤íŠ¸ë„ ì¶©ë¶„íˆ ì‘ì„±í•˜ì—¬ ì•ˆì •ì„±ì„ í™•ë³´í•©ë‹ˆë‹¤.
- **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ (Test Coverage) ì¸¡ì •:** ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë„êµ¬ (ì˜ˆ: Jest Coverage) ë¥¼ ì‚¬ìš©í•˜ì—¬ í…ŒìŠ¤íŠ¸ê°€ ì½”ë“œì˜ ì–´ëŠ ë¶€ë¶„ì„ ì–¼ë§ˆë‚˜ ì»¤ë²„í•˜ëŠ”ì§€ í™•ì¸í•˜ê³ , ë¶€ì¡±í•œ ë¶€ë¶„ì„ ë³´ì™„í•©ë‹ˆë‹¤. (í•˜ì§€ë§Œ ì»¤ë²„ë¦¬ì§€ ìˆ«ìì—ë§Œ ë§¤ëª°ë˜ì§€ ì•Šê³ , ì‹¤ì œ ì¤‘ìš”í•œ ë¡œì§ ìœ„ì£¼ë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ê²ƒì´ ë” ì¤‘ìš”í•©ë‹ˆë‹¤!)
- **ìë™í™”ëœ í…ŒìŠ¤íŠ¸ í™˜ê²½ êµ¬ì¶•:** CI/CD íŒŒì´í”„ë¼ì¸ì— í…ŒìŠ¤íŠ¸ë¥¼ í†µí•©í•˜ì—¬, ì½”ë“œ ë³€ê²½ ì‹œ ìë™ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ë„ë¡ í•©ë‹ˆë‹¤.


## ğŸ“ íšŒê³ : í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± í›„ ê¹¨ë‹¬ì€ ì ê³¼ ê°œì„  ë°©í–¥

### 1. ì˜ˆì‹œ ì½”ë“œì˜ í•œê³„ì  ì¸ì‹
ì‘ì„±ëœ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ **ê³„ì¸µë³„ ì±…ì„ ë¶„ë¦¬**ì— ì™„ë²½íˆ ë¶€í•©í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
ì£¼ìš” ë¬¸ì œì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

#### ë¬¸ì œì 
- **ì„œë¹„ìŠ¤ ë ˆì´ì–´ì—ì„œì˜ ìœ íš¨ì„± ê²€ì‚¬ ê²€ì¦**
ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸(`AuthService`)ì—ì„œ ì´ë©”ì¼ í˜•ì‹ ê²€ì¦ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.
â†’ ì´ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ì±…ì„ì´ë©°, ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ëŠ” **ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê²€ì¦**ì— ì§‘ì¤‘í•´ì•¼ í•©ë‹ˆë‹¤.
- **í†µí•© í…ŒìŠ¤íŠ¸ì™€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ì˜ ëª¨í˜¸í•œ ê²½ê³„**
`AuthService` í…ŒìŠ¤íŠ¸ì—ì„œ `UserRepository`ë¥¼ ëª¨í‚¹í–ˆì§€ë§Œ, ì‹¤ì œ ì˜ì¡´ì„±ê³¼ì˜ ìƒí˜¸ì‘ìš© ê²€ì¦ì´ ë¶€ì¡±í–ˆìŠµë‹ˆë‹¤.

### 2. ê°œì„ ì„ ìœ„í•œ ì‹¤ì²œ ë°©ì•ˆ

#### (1) ê³„ì¸µë³„ í…ŒìŠ¤íŠ¸ ì² ì €í•œ ë¶„ë¦¬
```typescript
// ì»¨íŠ¸ë¡¤ëŸ¬ í…ŒìŠ¤íŠ¸: ìœ íš¨ì„± ê²€ì‚¬ ì±…ì„
it('should reject invalid email in controller', async () => {
const invalidDto = { email: 'wrong-format', password: 'Test123!@#' };
const response = await request(app.getHttpServer())
.post('/auth/login')
.send(invalidDto);

expect(response.status).toBe(400);
expect(response.body.message).toContain('email must be an email');
});

// ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸: ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì±…ì„ (ëª¨í‚¹ í™œìš©)
it('should handle login logic without validation', async () => {
const validDto = { email: 'test@example.com', password: 'Test123!@#' };
mockUserRepository.findOne.mockResolvedValue({ /* ... */ });
// ìœ íš¨ì„± ê²€ì‚¬ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì™„ë£Œë˜ì—ˆë‹¤ê³  ê°€ì •
});
```


#### (2) Contract Testing ë„ì… 
ì»¨íŠ¸ë¡¤ëŸ¬-ì„œë¹„ìŠ¤ ê°„ ê³„ì•½ ì •ì˜:
```typescript
// auth.contract.ts
export interface AuthServiceContract {
login(dto: LoginDto): Promise<{ accessToken: string }>;
}

// í…ŒìŠ¤íŠ¸ì—ì„œ ê³„ì•½ ê²€ì¦
it('should fulfill controller-service contract', async () => {
const dto = validLoginDto;
const expectedResult = { accessToken: 'token' };

mockAuthService.login.mockResolvedValue(expectedResult);
const result = await controller.login(dto);

expect(result).toEqual(expectedResult);
});`
```

#### (3) E2E í…ŒìŠ¤íŠ¸ë¡œ Validation ë³´ê°•
```typescript
// e2e/auth.e2e-spec.ts
describe('Auth API Validation (e2e)', () => {
  it('should block registration with weak password', async () => {
    const weakPasswordDto = {
    email: 'test@example.com',
    password: '1234', // 6ì ë¯¸ë§Œ
    name: 'í™ê¸¸ë™',
    gender: Gender.MALE,
    country: 'KR'
    };
  
    const response = await request(app.getHttpServer())
    .post('/auth/register')
    .send(weakPasswordDto);
    
    expect(response.status).toBe(400);
    expect(response.body.message).toContain('password is too weak');
  });
});
```

### 3. ê¹¨ë‹¬ì€ êµí›ˆ
   í…ŒìŠ¤íŠ¸ ì „ëµ ìˆ˜ë¦½ì˜ ì¤‘ìš”ì„±:
   í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„± ì „ì— ê³„ì¸µë³„ í…ŒìŠ¤íŠ¸ ë²”ìœ„ë¥¼ ëª…í™•íˆ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

* ë‹¨ìœ„ í…ŒìŠ¤íŠ¸: í•¨ìˆ˜/í´ë˜ìŠ¤ ë‹¨ìœ„ ê²©ë¦¬ ê²€ì¦
* í†µí•© í…ŒìŠ¤íŠ¸: ëª¨ë“ˆ ê°„ ìƒí˜¸ì‘ìš© ê²€ì¦
* E2E í…ŒìŠ¤íŠ¸: ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ ê²€ì¦


Mockingì˜ ì–‘ë©´ì„±
ê³¼ë„í•œ ëª¨í‚¹ì€ í…ŒìŠ¤íŠ¸ì™€ ì‹¤ì œ ì½”ë“œì˜ ê´´ë¦¬ë¥¼ ë§Œë“­ë‹ˆë‹¤.
â†’ ì˜ì¡´ì„± ì£¼ì… í”„ë ˆì„ì›Œí¬ í™œìš©ì´ë‚˜ ê³„ì•½ í…ŒìŠ¤íŠ¸ë¡œ ì™„í™” ê°€ëŠ¥í•©ë‹ˆë‹¤.

ìœ ì§€ë³´ìˆ˜ì„± ê³ ë ¤:
í…ŒìŠ¤íŠ¸ ì½”ë“œë„ ë¦¬íŒ©í† ë§ì´ í•„ìš”í•©ë‹ˆë‹¤.
â†’ ì¤‘ë³µ ì½”ë“œ ì œê±°, í…ŒìŠ¤íŠ¸ í”½ìŠ¤ì²˜(factory.ts) í™œìš©, ê°€ë…ì„± ê°œì„  í•„ìˆ˜!


### ê²°ë¡  
1. í…ŒìŠ¤íŠ¸ëŠ” ì–´ë µì§€ë§Œ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
2. ì™„ë²½í•œ í…ŒìŠ¤íŠ¸ëŠ” ì—†ìœ¼ë©° ì§€ì†ì ì¸ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.
3. í…ŒìŠ¤íŠ¸ í•˜ê¸° ì‹«ë‹¤ ã…œã…œã…œ

